"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("vue-demi");function ee(e){return u.getCurrentScope()?(u.onScopeDispose(e),!0):!1}function B(){const e=new Set,o=t=>{e.delete(t)};return{on:t=>{e.add(t);const s=()=>o(t);return ee(s),{off:s}},off:o,trigger:(...t)=>Promise.all(Array.from(e).map(s=>s(...t)))}}function b(e,o){return o==null?u.unref(e):u.unref(e)[o]}function te(e){return typeof e=="function"?e():u.unref(e)}const fe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ge=Object.prototype.toString,de=e=>ge.call(e)==="[object Object]",pe=()=>{};function ne(e){return u.getCurrentInstance()}function _(e,o=!0,n){ne()?u.onMounted(e,n):o?e():u.nextTick(e)}function me(e,o){ne()&&u.onUnmounted(e,o)}function q(e){var o;const n=te(e);return(o=n==null?void 0:n.$el)!=null?o:n}const ye=fe?window:void 0;function A(...e){let o,n,r,t;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,r,t]=e,o=ye):[o,n,r,t]=e,!o)return pe;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const s=[],f=()=>{s.forEach(y=>y()),s.length=0},v=(y,x,S,N)=>(y.addEventListener(x,S,N),()=>y.removeEventListener(x,S,N)),d=u.watch(()=>[q(o),te(t)],([y,x])=>{if(f(),!y)return;const S=de(x)?{...x}:x;s.push(...n.flatMap(N=>r.map(k=>v(y,N,k,S))))},{immediate:!0,flush:"post"}),p=()=>{d(),f()};return ee(p),p}function oe(e,o=null){const n=u.getCurrentInstance();let r=()=>{};const t=u.customRef((s,f)=>(r=f,{get(){var v,d;return s(),(d=(v=n==null?void 0:n.proxy)==null?void 0:v.$refs[e])!=null?d:o},set(){}}));return _(r),u.onUpdated(r),t}function I(e,o){for(let n=0,r=e.length;n<r;n++)if(o.apply(o,[e[n],n,e]))return e[n]}function z(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Function]"}function re(e){return!!("targetTouches"in e&&e.targetTouches&&"changedTouches"in e&&e.changedTouches)}function H(e){return!Number.isNaN(e)}function D(e){return Number.parseInt(e,10)}const R=["Moz","Webkit","O","ms"];function he(e="transform"){var n,r;if(typeof window>"u")return"";const o=(r=(n=window.document)==null?void 0:n.documentElement)==null?void 0:r.style;if(!o||e in o)return"";for(let t=0;t<R.length;t++)if(ae(e,R[t])in o)return R[t];return""}function ae(e,o){return o?`${o}${ve(e)}`:e}function ve(e){let o="",n=!0;for(let r=0;r<e.length;r++)n?(o+=e[r].toUpperCase(),n=!1):e[r]==="-"?n=!0:o+=e[r];return o}const be=he();let Y="";function De(e,o){return Y||(Y=I(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],n=>z(e[n]))),z(e[Y])?e[Y](o):!1}function K(e,o,n){let r=e;do{if(De(r,o))return!0;if(r===n)return!1;r=r.parentNode}while(r);return!1}function Q(e,o,n,r){if(!e)return;const t={capture:!0,...r};e.addEventListener?e.addEventListener(o,n,t):e[`on${o}`]=n}function Z(e,o,n,r){if(!e)return;const t={capture:!0,...r};e.removeEventListener?e.removeEventListener(o,n,t):e[`on${o}`]=null}function Se(e){var r;let o=e.clientHeight;const n=(r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e);return o+=D(n==null?void 0:n.borderTopWidth),o+=D(n==null?void 0:n.borderBottomWidth),o}function we(e){var r;let o=e.clientWidth;const n=(r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e);return o+=D(n==null?void 0:n.borderLeftWidth),o+=D(n==null?void 0:n.borderRightWidth),o}function Ce(e,o){return I(e.targetTouches,n=>o===n.identifier)||I(e.changedTouches,n=>o===n.identifier)}function xe(e){if(re(e)){if(e.targetTouches[0])return e.targetTouches[0].identifier;if(e.changedTouches[0])return e.changedTouches[0].identifier}}function Te(e){var r;let o=e.clientHeight;const n=(r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e);return o-=D(n==null?void 0:n.paddingTop),o-=D(n==null?void 0:n.paddingBottom),o}function Ne(e){var r;let o=e.clientWidth;const n=(r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e);return o-=D(n==null?void 0:n.paddingLeft),o-=D(n==null?void 0:n.paddingRight),o}function Pe(e,o,n){const t=o===o.ownerDocument.body?{left:0,top:0}:o.getBoundingClientRect(),s=(e.clientX+o.scrollLeft-t.left)/n,f=(e.clientY+o.scrollTop-t.top)/n;return{x:s,y:f}}function Ee(e,o){const n=se(e,"px",o);return{[ae("transform",be)]:n}}function Me(e,o){return se(e,"",o)}function se({x:e,y:o},n="px",r){let t=`translate(${Math.round(e)}${n},${Math.round(o)}${n})`;if(r){const s=`${typeof r.x=="string"?r.x:Math.round(r.x)+n}`,f=`${typeof r.y=="string"?r.y:Math.round(r.y)+n}`;t=`translate(${s}, ${f})${t}`}return t}function je(e){if(!e)return;if(!e.getElementById("revue-draggable-style-el")){const n=e.createElement("style");n.type="text/css",n.id="revue-draggable-style-el",n.innerHTML=`.revue-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,n.innerHTML+=`.revue-draggable-transparent-selection *::selection {all: inherit;}
`,e.getElementsByTagName("head")[0].appendChild(n)}e.body&&$e(e.body,"revue-draggable-transparent-selection")}function Le(e){if(e)try{e.body&&Oe(e.body,"revue-draggable-transparent-selection");const o=(e.defaultView||window).getSelection();o&&o.type!=="Caret"&&o.removeAllRanges()}catch{}}function $e(e,o){e.classList?e.classList.add(o):e.className.match(new RegExp(`(?:^|\\s)${o}(?!\\S)`))||(e.className+=` ${o}`)}function Oe(e,o){e.classList?e.classList.remove(o):e.className=e.className.replace(new RegExp(`(?:^|\\s)${o}(?!\\S)`,"g"),"")}function Be({bounds:e,x:o,y:n,node:r}){if(!e)return[o,n];if(e=typeof e=="string"?e:Ae(e),typeof e=="string"){const{ownerDocument:t}=r,s=t.defaultView,f=e==="parent"?r.parentNode:t.querySelector(e);if(!(s&&f instanceof s.HTMLElement))throw new Error(`Bounds selector "${e}" could not find an element.`);const v=s.getComputedStyle(r),d=s.getComputedStyle(f),p="offsetLeft"in r?r.offsetLeft:0,y="offsetTop"in r?r.offsetTop:0;e={left:-(p-f.offsetLeft)+D(d.paddingLeft)+D(v.marginLeft),top:-(y-f.offsetTop)+D(d.paddingTop)+D(v.marginTop),right:Ne(f)-we(r)-p+D(d.paddingRight)-D(v.marginRight),bottom:Te(f)-Se(r)-y+D(d.paddingBottom)-D(v.marginBottom)}}return H(e.right)&&(o=Math.min(o,e.right)),H(e.bottom)&&(n=Math.min(n,e.bottom)),H(e.left)&&(o=Math.max(o,e.left)),H(e.top)&&(n=Math.max(n,e.top)),[o,n]}function ke(e,o,n){const r=Math.round(o/e[0])*e[0],t=Math.round(n/e[1])*e[1];return[r,t]}function Ue(e){return e==="both"||e==="x"}function Fe(e){return e==="both"||e==="y"}function X({e,touch:o,node:n,offsetContainer:r,scale:t}){const s=typeof o=="number"&&re(e)?Ce(e,o):null;if(typeof o=="number"&&!s)return null;const f=r||"offsetParent"in n&&n.offsetParent||n.ownerDocument.body;return Pe(s||e,f,t)}function W({node:e,x:o,y:n,lastX:r,lastY:t}){return Number.isNaN(r)?{node:e,deltaX:0,deltaY:0,lastX:o,lastY:n,x:o,y:n}:{node:e,deltaX:o-r,deltaY:n-t,lastX:r,lastY:t,x:o,y:n}}function G({x:e,y:o,data:n}){return{node:n.node,x:e+n.deltaX,y:o+n.deltaY,deltaX:n.deltaX,deltaY:n.deltaY,lastX:e,lastY:o}}function Ae(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom}}function O(...e){typeof process<"u"&&process.env.DRAGGABLE_DEBUG&&console.log(...e)}const ie=e=>{const o=u.reactive(Object.assign({allowAnyClick:!1,cancel:"",handle:"",disabled:!1,enableUserSelectHack:!0,enableTransformFix:!1,offsetParent:void 0,grid:void 0,start:()=>{},move:()=>{},stop:()=>{},mouseDown:()=>{},position:void 0,currentPosition:{x:Number.NaN,y:Number.NaN},positionOffset:void 0,scale:1,axis:"both",defaultClassNameDragging:"revue-draggable-dragging",defaultClassNameDragged:"revue-draggable-dragged",defaultClassName:"revue-draggable",defaultPosition:{x:0,y:0},bounds:!1,dragging:!1,dragged:!1,prevPropsPosition:{x:0,y:0},isElementSVG:!1,update:!0},e));return()=>o},P={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let $=P.mouse;function V(e,o,n){const r=u.ref(),t=z(o)?o():ie(o)(),s=u.reactive({x:Number.NaN,y:Number.NaN}),f=B(),v=B(),d=B();return u.effectScope().run(()=>{u.watch(()=>t,l=>{l.position&&!l.dragging&&(s.x=Number.NaN,s.y=Number.NaN)});const y=l=>{var c;const h=b(r);if(!t.allowAnyClick&&"button"in l&&l.button!==0)return!1;if(!h||!h.ownerDocument||!h.ownerDocument.body)throw new Error("No ref element found on DragStart!");const{ownerDocument:w}=h;if(t.disabled||!(w.defaultView&&l.target!==null&&l.target instanceof w.defaultView.Node)||t.handle&&!K(l.target,t.handle,h)||t.cancel&&K(l.target,t.cancel,h))return;l.type==="touchstart"&&l.preventDefault(),t.touch=xe(l);const T=X({e:l,touch:t.touch,node:h,offsetContainer:t.offsetParent,scale:t.scale});if(T==null)return;const{x:C,y:a}=T,i=W({node:h,x:C,y:a,lastX:s.x,lastY:s.y});O("DraggableCore: handleDragStart: %j",i);const g=n?!0:(c=t.start)==null?void 0:c.call(t,l,i);if(f.trigger({event:l,data:i}),(g||t.update)===!1)return!1;t.enableUserSelectHack&&je(w),t.dragging=!0,s.x=C,s.y=a,Q(w,$.move,x),Q(w,$.stop,S)},x=l=>{var w;const h=b(r);if(h){const E=X({e:l,touch:t.touch,node:h,offsetContainer:t.offsetParent,scale:t.scale});if(E==null)return;let{x:T,y:C}=E;const a=t.grid;if(a&&Array.isArray(a)){let c=T-s.x,m=C-s.y;if([c,m]=ke(a,c,m),!c&&!m)return;T=s.x+c,C=s.y+m}const i=W({node:h,x:T,y:C,lastX:s.x,lastY:s.y});O("DraggableCore: handleDrag: %j",i);const g=n?!0:(w=t.move)==null?void 0:w.call(t,l,i);if(v.trigger({event:l,data:i}),(g||t.update)===!1){try{S(new MouseEvent("mouseup"))}catch{const m=document.createEvent("MouseEvents");m.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),S(m)}return}s.x=T,s.y=C}},S=l=>{var w;const h=b(r);if(t.dragging&&h){const E=X({e:l,touch:t.touch,node:h,offsetContainer:t.offsetParent,scale:t.scale});if(E==null)return;const{x:T,y:C}=E,a=W({node:h,x:T,y:C,lastX:s.x,lastY:s.y}),i=n?!0:(w=t.stop)==null?void 0:w.call(t,l,a);if(d.trigger({event:l,data:a}),(i||t.update)===!1)return!1;t.enableUserSelectHack&&Le(h.ownerDocument),O("DraggableCore: handleDragStop: %j",a),t.dragging=!1,O("DraggableCore: Removing handlers"),Z(h.ownerDocument,$.move,x),Z(h.ownerDocument,$.stop,S)}},N=l=>{var h;if($=P.mouse,(h=t.mouseDown)==null||h.call(t,l),l.which!=3)return y(l)},k=l=>($=P.mouse,S(l)),U=l=>($=P.touch,y(l)),F=l=>($=P.touch,S(l));_(()=>{if(r.value=q(e),!r.value){console.error("You are trying to use <DraggableCore> without passing a valid node reference. Canceling initialization.");return}A(b(r),P.touch.start,U,{passive:!1}),A(b(r),P.touch.stop,F),A(b(r),P.mouse.start,N),A(b(r),P.mouse.stop,k)})}),{...u.toRefs(t),state:t,onDragStart:f.on,onDrag:v.on,onDragStop:d.on}}function J(e,o){const n=u.ref(),r=ie(o),t=r(),s=B(),f=B(),v=B(),d=B();return u.effectScope().run(()=>{const y=(a,i)=>{O("Draggable: onDragStart: %j",i);const g=G({data:i,...t.currentPosition}),c=t.start?t.start(a,g):t.update;if(s.trigger({event:a,data:g}),typeof c<"u"&&!c)return!1;t.dragging=!0,t.dragged=!0},x=(a,i)=>{if(!t.dragging)return!1;O("Draggable: onDrag: %j",i);const g=G({data:i,...t.currentPosition}),c={x:g.x,y:g.y};if(t.bounds){const[M,j]=Be({bounds:t.bounds,x:c.x,y:c.y,node:i.node});c.x=M,c.y=j,g.x=c.x,g.y=c.y,g.deltaX=c.x-t.currentPosition.x,g.deltaY=c.y-t.currentPosition.y}const m=t.move?t.move(a,g):t.update;if(f.trigger({event:a,data:g}),typeof m<"u"&&!m)return!1;t.currentPosition=c,F()},S=(a,i)=>{if(!t.dragging)return!1;const g=G({data:i,...t.currentPosition}),c=t.stop?t.stop(a,g):t.update;if(v.trigger({event:a,data:g}),typeof c<"u"&&!c)return!1;O("Draggable: onDragStop: %j",i),t.enableTransformFix&&N(),t.dragging=!1},N=()=>{var c,m;const a=b(n);if(!a)return;a.style.transform="",a.style.left="",a.style.top="",a.style.position="relative";const{x:i,y:g}=U.value;a.style.left=`${Math.round(D((c=t.positionOffset)==null?void 0:c.x)||0)+Math.round(Number(i))}px`,a.style.top=`${Math.round(D((m=t.positionOffset)==null?void 0:m.y)||0)+Math.round(Number(g))}px`},k=()=>{const a=b(n);a&&(a.style.transform="",a.style.position="",a.style.left="",a.style.top="")},U=u.computed(()=>{const a=!!t.position||t.dragging,i=t.position||t.defaultPosition;return{x:Ue(t.axis)&&b(a)?t.currentPosition.x:b(i).x,y:Fe(t.axis)&&b(a)?t.currentPosition.y:b(i).y}}),F=(a=!1)=>{const i=b(n);if(i&&(a||t.update&&t.dragging)){t.enableTransformFix&&k();const g=t.positionOffset,c=t.isElementSVG,m=!c&&Ee(b(U),g)||!1,M=c&&Me(b(U),g)||!1;if(typeof M=="string"&&i.setAttribute("transform",M),m)for(const L of Object.keys(m))L==="transform"&&(m[L]+=`${i.style[L]}`.replace(/translate\((-?\d+?.{0,2},? ?)+\)+/gm,"").trim()),i.style[L]=m[L];const j={el:b(n),style:m,transform:M,classes:l.value};d.trigger(j)}},l=u.computed(()=>({[t.defaultClassName]:!t.disabled,[t.defaultClassNameDragging]:t.dragging,[t.defaultClassNameDragged]:t.dragged})),h=()=>Object.keys(b(l)).forEach(a=>{var i,g;b(l)[a]?(i=b(n))==null||i.classList.toggle(a,!0):(g=b(n))==null||g.classList.toggle(a,!1)});u.watch(l,h);const{onDragStart:w,onDrag:E,onDragStop:T}=V(e,r,!0);E(({event:a,data:i})=>x(a,i)),w(({event:a,data:i})=>y(a,i)),T(({event:a,data:i})=>S(a,i));const C=(a=!1)=>{const i=t.position;O("Draggable: Updated %j",{position:t.currentPosition,prevPropsPosition:t.prevPropsPosition}),i&&(t.currentPosition=i,t.prevPropsPosition={...i}),t.enableTransformFix?N():F(a)};me(()=>{t.dragging=!1}),_(()=>{var M;if(n.value=q(e),!n){console.error("You are trying to use <Draggable> without passing a valid target reference.");return}let a=0,i=0;const g=t.position,c=t.defaultPosition,m=(M=b(n))==null?void 0:M.style;g&&typeof g.x<"u"?a=g.x:c&&typeof c.x<"u"?a=c.x:m&&m.top&&(a=D(m.top)),g&&typeof g.y<"u"?i=g.y:c&&typeof c.y<"u"?i=c.y:m&&m.left&&(i=D(m.left)),t.currentPosition={x:a,y:i},h(),C(!0),u.watch(()=>t.position,j=>{let L=!1;((j==null?void 0:j.x)!==t.currentPosition.x||j.y!==t.currentPosition.y)&&(L=!0),C(L)})})}),{...u.toRefs(t),state:t,onDragStart:s.on,onDrag:f.on,onDragStop:v.on,onTransformed:d.on}}const He=(e,o)=>{const n=u.getCurrentInstance(),r=(n==null?void 0:n.emit)??((t,s)=>{const f=new CustomEvent(t,{detail:s});e.dispatchEvent(f)});if(o.arg==="core"){const{onDrag:t,onDragStop:s,onDragStart:f,state:v}=V(e,o.value);t(d=>{r("move",d)}),f(d=>{r("start",d)}),s(d=>{r("stop",d)}),e["revue-draggable"]=v}else{const{onDrag:t,onDragStop:s,onDragStart:f,onTransformed:v,state:d}=J(e,o.value);t(p=>{r("move",p)}),f(p=>{r("start",p)}),s(p=>{r("stop",p)}),v(p=>{r("transformed",p)}),e["revue-draggable"]=d}},Ye=(e,o)=>{const n=e;if(typeof n["revue-draggable"]<"u"&&o.value&&JSON.stringify(o.value)!==JSON.stringify(o.oldValue)){const r=n["revue-draggable"];Object.assign(r,o.value)}},Ve={[u.isVue3?"mounted":"inserted"]:He,[u.isVue3?"beforeUpdate":"update"]:Ye},ue=Ve,Re=u.defineComponent({name:"Draggable",props:{axis:{type:String,default:"both"},bounds:{type:[Object,String,Boolean],default:!1},defaultClassName:{type:String,default:"revue-draggable"},defaultClassNameDragging:{type:String,default:"revue-draggable-dragging"},defaultClassNameDragged:{type:String,default:"revue-draggable-dragged"},defaultPosition:{type:Object,default:()=>({x:0,y:0})},scale:{type:Number,default:1},position:{type:Object,default:void 0},positionOffset:{type:Object,default:void 0},allowAnyClick:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},enableUserSelectHack:{type:Boolean,default:!0},enableTransformFix:{type:[Boolean,Object],default:!1},cancel:{type:String,default:void 0},offsetParent:{type:Object,default:()=>{}},grid:{type:Array,default:void 0},handle:{type:String,default:void 0},update:{type:Boolean,default:!0},start:{type:Function,default:()=>{}},move:{type:Function,default:()=>{}},stop:{type:Function,default:()=>{}},mouseDown:{type:Function,default:()=>{}}},emits:["move","start","stop","transformed"],setup(e,{slots:o,emit:n,attrs:r}){const t=oe("target",null),{onDrag:s,onDragStart:f,onDragStop:v,onTransformed:d,state:p}=J(t,e);return s(y=>n("move",y)),f(y=>n("start",y)),v(y=>n("stop",y)),d(y=>n("transformed",y)),u.watch(()=>e,y=>Object.assign(p,y),{deep:!0,flush:"post"}),u.isVue3?()=>{if(o.default)return u.h(o.default({state:p})[0],{ref:"target",...r},{})}:()=>{if(o.default)return u.h("div",{ref:"target",...r},o.default({state:p}))}}}),le=Re,Xe=u.defineComponent({name:"DraggableCore",props:{scale:{type:Number,default:1},allowAnyClick:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},enableUserSelectHack:{type:Boolean,default:!0},cancel:{type:String,default:void 0},offsetParent:{type:Object,default:void 0},grid:{type:Array,default:void 0},handle:{type:String,default:void 0},onStart:{type:Function,default:()=>{}},onMove:{type:Function,default:()=>{}},onStop:{type:Function,default:()=>{}},onMouseDown:{type:Function,default:()=>{}}},emits:["start","move","stop"],setup(e,{slots:o,emit:n,attrs:r}){const t=oe("core-target",null),{onDrag:s,onDragStart:f,onDragStop:v,state:d}=V(t,e);return s(p=>n("move",p)),f(p=>n("start",p)),v(p=>n("stop",p)),u.watch(()=>e,p=>Object.assign(d,p),{deep:!0,flush:"post"}),u.isVue3?()=>{if(o.default)return u.h(o.default()[0],{ref:"core-target",...r},{})}:()=>{if(o.default)return u.h("div",{ref:"core-target",...r},o.default())}}}),ce=Xe,We=e=>{e.component("Draggable",le),e.component("DraggableCore",ce),e.directive("draggable",ue)},Ge=We;exports.Draggable=le;exports.DraggableCore=ce;exports.DraggableDirective=ue;exports.DraggablePlugin=Ge;exports.useDraggable=J;exports.useDraggableCore=V;
